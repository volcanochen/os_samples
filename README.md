# 中断响应时间测试内核模块

本内核模块用于测试中断响应时间，借助高精度定时器周期性触发 GPIO 引脚电平变化来触发硬件中断，记录每次中断处理的时间，并在模块卸载时计算并输出平均中断处理时间。

## 功能概述

- **中断处理计时**：每次中断发生时，记录中断开始和结束的时间，计算单次中断处理时间。
- **平均时间计算**：在模块卸载时，统计所有中断处理时间的总和，并计算平均中断处理时间。
- **高精度定时器**：使用 `hrtimer` 实现高精度定时，可用于模拟中断触发等操作。

### GPIO 相关说明

- 引脚编号 ：代码中使用的 GPIO 引脚编号为 GPIO_PIN_NUMBER ，当前设置为 17 ，你需要根据实际硬件情况进行修改。
- 初始化操作 ：模块加载时会自动初始化该 GPIO 引脚为输出模式，并通过高精度定时器周期性改变其电平，以触发硬件中断。

## 编译内核模块

确保你已经正确修改了代码并修复了编译错误，然后在项目目录下执行以下命令来编译内核模块：

```bash
make
```

## 加载内核模块

编译成功后，会生成一个 .ko 格式的内核模块文件（例如 interrupt_response_time.ko ）。使用以下命令来加载这个模块：

```bash
sudo insmod interrupt_response_time.ko
```

## 查看内核日志

加载模块后，内核会开始记录中断处理的相关信息。你可以使用以下命令来查看内核日志，了解中断处理的时间和其他信息：

```bash
dmesg
```

## 卸载内核模块

当你完成测试后，使用以下命令卸载内核模块：

```bash
sudo rmmod interrupt_response_time
```

## 再次查看内核日志

卸载模块后，内核会输出平均中断处理时间。再次使用以下命令查看这些信息：

```bash
dmesg
```

## 注意事项

- 中断号 ：代码中使用的中断号 INTERRUPT_NUMBER 是假设的，你需要根据实际情况修改为有效的中断号。
- 权限问题 ：加载和卸载内核模块需要管理员权限，因此需要使用 sudo 命令。
- 错误处理 ：如果在加载或卸载模块时出现错误，可以使用 dmesg 命令查看详细的错误信息，以便进行调试。
